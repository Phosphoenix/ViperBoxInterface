<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%F0%9F%A7%A0-viperboxinterface">🧠 ViperBoxInterface</h1>
<figure align="center">
    <img src="imgs\viperboxinterface.png" style="width: 50%; height: auto;">
    <!-- <figcaption>Overview of all the settings for one ViperBox</figcaption> -->
</figure>
<blockquote>
<p>ViperBoxInterface is a piece of software that streamlines interaction with the ViperBox developed for the NeuraViPeR project.
It streams data through <a href="#open-ephys">Open Ephys</a>.</p>
</blockquote>
<h1 id="%F0%9F%93%9A-table-of-contents">📚 Table of Contents</h1>
<!-- TOC -->
<ul>
<li><a href="#-viperboxinterface">🧠 ViperBoxInterface</a></li>
<li><a href="#-table-of-contents">📚 Table of Contents</a></li>
<li><a href="#-installation">📦 Installation</a>
<ul>
<li><a href="#starting-up">Starting up</a></li>
<li><a href="#gain-settings">Gain settings</a></li>
<li><a href="#references-and-input-settings">References and input settings</a></li>
<li><a href="#choosing-probe-electrodes">Choosing probe electrodes</a></li>
</ul>
</li>
<li><a href="#-using-the-gui">🖥️ Using the GUI</a></li>
<li><a href="#-faq">❓ FAQ</a></li>
<li><a href="#-using-the-api">🤖 Using the API</a></li>
<li><a href="#-overview-of-viperbox-settings">🛠️ Overview of ViperBox settings</a></li>
<li><a href="#-changing-settings-through-xml-scripts">📝 Changing settings through XML scripts</a>
<ul>
<li><a href="#recordingsettings">RecordingSettings</a></li>
<li><a href="#stimulation-settings">Stimulation settings</a></li>
</ul>
</li>
<li><a href="#%E2%80%8D-related-software">👨‍💻 Related software</a>
<ul>
<li><a href="#open-ephys">Open Ephys</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="%F0%9F%93%A6-installation">📦 Installation</h1>
<p>The computer needs to run Windows 64-bit.</p>
<p>Installation instructions:</p>
<ol>
<li>go to the <a href="https://github.com/sbalk/ViperBoxInterface/releases">ViperBoxInterface release page</a> and download the latest release 'Source code (zip)' under 'Assets'</li>
<li>unzip the downloaded file and optionally move them to a location where you want to keep all the files</li>
<li>in the unzipped folder, navigate to the folder called 'setup'</li>
<li>right-click 'installation_script.ps1' &gt; 'Run with PowerShell'</li>
<li>the script will install the necessary software and drivers, this might take more than 20 minutes. If any problems arise, please take up contact.</li>
</ol>
<h2 id="starting-up">Starting up</h2>
<p>The script creates a shortcut on the desktop called &quot;ViperBoxAPI&quot;, this will start the server. The server can then be reached from http://127.0.0.1:8000. You can also start the software by navigating to the folder where the software is downloaded and double-click start_app.bat.</p>
<p>If that doesn't work (see <a href="#faq">FAQ</a>), you can start the software by following these steps (also make sure you have the latest version of the software):</p>
<ol>
<li>Open Anaconda Prompt (you can find it by searching for it in the start menu)</li>
<li>Type <code>conda activate viperbox</code> and press enter</li>
<li>Navigate to the folder where the software is downloaded by typing <code>cd &lt;path to the folder&gt;</code></li>
<li>Type <code>uvicorn main:app --reload</code> and press enter</li>
</ol>
<figure align="center">
    <img src="imgs\viperbox_gui.png" style="width: 80%; height: auto;">
    <figcaption>ViperBox GUI</figcaption>
</figure>
<p>In <em>ViperBox control</em>, you can</p>
<ul>
<li>Connect and disconnect to the ViperBox</li>
<li>Change recording file and location and start and stop the recording. You can also stimulate if you are recording.</li>
<li>Upload settings to the ViperBox. You can either upload the recording or stimulation settings you set in the GUI or you can upload default settings.</li>
</ul>
<p>In <em>Recording settings</em>, you can change the recording settings. In the IMTEK probes, only the body <a href="#references-and-input-settings">reference</a> is connected to the ASIC. To use the correct gain, please refer to <a href="#gain-settings">Gain settings</a>. To change from which electrode you want to record, refer to <a href="#choosing-probe-electrodes">Choosing probe electrodes</a>.</p>
<p>In <em>Waveform settings</em>, you can change the stimulation waveform.</p>
<p>In <em>Pulse preview</em>, you can preview the stimulation waveform after you press <code>Reload</code>.</p>
<p>In <em>Stimulation mapping</em>, you can select from which electrodes you want to stimulate.</p>
<h2 id="gain-settings">Gain settings</h2>
<blockquote>
<p>[!WARNING]
To correctly view the voltage levels in Open Ephys, the following scaling and offset numbers need to be supplied to the Ephys Socket in Open ephys:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Gain</th>
<th>Scale</th>
<th>Offset</th>
</tr>
</thead>
<tbody>
<tr>
<td>60</td>
<td>5.617</td>
<td>2048</td>
</tr>
<tr>
<td>24</td>
<td>11.23</td>
<td>2048</td>
</tr>
<tr>
<td>12</td>
<td>19.78</td>
<td>2048</td>
</tr>
<tr>
<td>0.16</td>
<td>879.1</td>
<td>2048</td>
</tr>
</tbody>
</table>
<figure align="center">
    <img src="imgs\ephys_socket_scale_offset.png" style="width: 30%; height: auto;">
    <figcaption>Screenshot of Ephys Socket in Open Ephys</figcaption>
</figure>
<h2 id="references-and-input-settings">References and input settings</h2>
<p>Reference settings are wired in the chip in the following way. For each of the 64 channels (or amplifiers), one electrode can be chosen from a set of 4 electrodes. This set is hardwired and cannot be changed.</p>
<p>This signal is compared to any or all of the references (which you can select in the GUI). In principle, the body reference should always be used.</p>
<figure align="center">
    <img src="imgs\references.png" style="width: 50%; height: auto;">
    <figcaption>Connection of recording channel (left) with recording electrodes (top right) and references (bottom right)</figcaption>
</figure>
<h2 id="choosing-probe-electrodes">Choosing probe electrodes</h2>
<p>With the IMTEK probe and the short wired MZIPA, it is not possible to record from all the 60 electrodes at the same time. However, it is possible to select from which electrode you want to record.</p>
<p>To change from which of the 4 electrodes you want to record (as mentioned in <a href="#references-and-input-settings">References and input settings</a>), edit the Excel file in the <code>defaults</code> folder, called <code>electrode_mapping_short_cables.xlsx</code>.</p>
<p>This mapping is specifically designed for the 4 shank IMTEK probe. The first column is the electrode on the IMTEK probe. You can choose the value in the 'Channel taken' column, it has to be set equal to a value in one of the 'input # channel' columns.</p>
<p>For example, you want Probe electrode 1 to be connected to channel 50, then in 'Channel taken', you change the value to <code>=E2</code>. This will update the sheet and but you will see that Probe electrode 2 now has 'Duplicate' in the 'Duplicate' column. This means that it won't be possible to record from Probe electrode 2 and the recording will be set to 0.</p>
<p>Only edit the 'Channel taken' column. Whenever the software starts or new settings are uploaded to the ViperBox, the Excel file will be read and the settings will be updated.</p>
<p>Note that in the resulting recording in Open Ephys, the 'Duplicate' channels will be set to an empty signal but their order is the same as on the IMTEK probe.</p>
<figure align="center">
    <img src="imgs\electrode_mapping_short_cables.png" style="width: 100%; height: auto;">
    <figcaption>Changing which Probe electrodes will be read out.</figcaption>
</figure>
<h1 id="%F0%9F%96%A5%EF%B8%8F-using-the-gui">🖥️ Using the GUI</h1>
<p>The GUI can be used to control the ViperBox directly. After starting up the software as described above in <a href="#starting-up">Starting up</a></p>
<p>Recording settings can only be changed when you are not recording.</p>
<h1 id="%E2%9D%93-faq">❓ (F)AQ</h1>
<ul>
<li>
<p><strong>Q</strong>: Open Ephys doesn't show any data, what can I do?</p>
<ul>
<li><strong>A</strong>: In the bottom left, click the connect button in the signal chain in the Ephys Socket module. After that, click the play button in the top right of the Open Ephys window.</li>
</ul>
</li>
<li>
<p><strong>Q</strong>: The shortcut is not working, what can I do?</p>
<ul>
<li>
<p><strong>A</strong>: This is probably due to the fact that PowerShell doesn't have rights as to execute the startup script, in particular, the <code>conda</code> command. There is a whole StackOverflow thread about this <a href="https://stackoverflow.com/questions/64149680/how-can-i-activate-a-conda-environment-from-powershell">here</a>. Probably the following might help:</p>
<ol>
<li>Open PowerShell and browse to <code>condabin</code> folder in your Conda installation directory, for example: <code>C:\Users\&lt;username&gt;\anaconda3\condabin</code></li>
<li>Run <code>./conda init powershell</code> in that folder, and reopen the PowerShell.</li>
<li>Please note: If you encountered <code>ps1 cannot be loaded because running scripts is disabled on this system</code>, simply run the PowerShell as Administrator and enter the following: <code>Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy Unrestricted</code></li>
<li>Try again to start the software by double-clicking the shortcut on the desktop.</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>Q</strong>: The software is not responding, what can I do?</p>
<ul>
<li><strong>A</strong>: Often, the best solution is to close all running instances of the software and hardware. This means pressing the power button on the ViperBox to shut it down and closing the software. If the software is stuck, you can got to Windows Task Manager and find a process called 'Python' and end it. Then, restart the software and the ViperBox.</li>
<li>Note: if you are running some other Python software, you won't be able to discern between the two. Don't stop a process if this can cause problems.</li>
</ul>
</li>
<li>
<p><strong>Q</strong>: What do the colors of the LED's on the ViperBox mean?</p>
<ul>
<li><strong>A</strong>: The LED's on the ViperBox have the following meanings:
<ul>
<li>ViperBox power button side
<ul>
<li>Green: the ViperBox is connected to the computer</li>
<li>Red: the ViperBox is not connected to the software or there is an error</li>
<li>Blue: the ViperBox is recording</li>
</ul>
</li>
<li>ViperBox SerDes side
<ul>
<li>White: headstage connected or emulation active</li>
<li>off: otherwise</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="%F0%9F%A4%96-using-the-api">🤖 Using the API</h1>
<p>The API can be used to communicate with the ViperBox. It can be used to connect to the ViperBox, upload recording and stimulation settings and start and stop recordings and stimulations.
The API can be manually controlled from the web interface by clicking the dropdown next to the function, then clicking &quot;Try it out&quot; and then clicking the blue &quot;Execute&quot; button.
The typical workflow to do a recording and stimulation is to run the following commands:</p>
<ul>
<li><code>/connect</code>: to connect to the ViperBox</li>
</ul>
<figure align="center">
    <img src="imgs\connect.gif" style="width: 80%; height: auto;">
    <!-- <figcaption>Overview of all the settings for one ViperBox</figcaption> -->
</figure>
<ul>
<li><code>/upload_recording_settings</code>: to upload the recording settings. Default <a href="#xml-scripts">XML settings</a> are selected by default.
<ul>
<li>To edit the settings, open an editor and copy the default settings from the defaults folder into it. Adjust them and copy and paste everything into the ViperBox API. See below.</li>
</ul>
</li>
</ul>
<figure align="center">
    <img src="imgs\recording_settings.gif" style="width: 80%; height: auto;">
    <!-- <figcaption>Overview of all the settings for one ViperBox</figcaption> -->
</figure>
<ul>
<li><code>/upload_stimulation_settings</code>: to upload the stimulation settings. Default settings are selected by default. XML settings can be added here, too.</li>
<li><code>/start_recording</code>: to start the recording. Don't forget to give up a name.</li>
<li><code>/start_stimulation</code>: to start the stimulation.</li>
<li><code>/stop_recording</code>: to stop the recording. The recording will be saved in the Recordings folder. The settings that you used to record will be saved in the Settings folder under the same name but as XML file.</li>
</ul>
<p>During a recording, new stimulation settings can be uploaded and a new stimulation can be started.</p>
<blockquote>
<p>[!WARNING]
<strong>Before version 0.0.4</strong>, there is a problem with the driver that is necessary to connect to the ViperBox. An incompatible driver is installed automatically overnight. Every time you start the ViperBoxInterface, you need to reinstall the driver. This can be done by following these steps:</p>
<ol>
<li>Connect ViperBox to PC and power on</li>
<li>Navigate to setup/DowngradeFTDI, and run the downgrade.bat batch file</li>
<li>Power cycle ViperBox</li>
<li>Optionally: verify driver version in Device Manager</li>
</ol>
</blockquote>
<h1 id="%F0%9F%9B%A0%EF%B8%8F-overview-of-viperbox-settings">🛠️ Overview of ViperBox settings</h1>
<figure align="center">
    <img src="imgs\settings_mindmap.png" style="width: 80%; height: auto;">
    <figcaption>Overview of all the settings for one ViperBox</figcaption>
</figure>
<ul>
<li>box: there are up to 3 boxes</li>
<li>probes: each box can have up to 4 probes connected to them</li>
<li>stimunit waveform settings: define the waveform that the stimunit generates</li>
<li>stimunit connected electrodes: each stimunit can be connected to any or all of the 128 electrodes.</li>
<li>recording channels: each box has 64 recording channels that each have several settings</li>
</ul>
<h1 id="%F0%9F%93%9D-changing-settings-through-xml-scripts">📝 Changing settings through XML scripts</h1>
<p>The way to communicate settings with the ViperBox is through XML scripts. These scripts can be used to define settings and to start and stop recording and stimulation. The XML scripts can be sent to the ViperBox through the API.</p>
<h2 id="recordingsettings">RecordingSettings</h2>
<p>Here is an example for setting the recording settings in XML format. The default recording settings are the following:</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Program</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Settings</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RecordingSettings</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Channel</span> <span class="hljs-attr">box</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">probe</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">channel</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">references</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">gain</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">input</span>=<span class="hljs-string">"0"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecordingSettings</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Settings</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Program</span>&gt;</span>
</div></code></pre>
<p>In the above code, the default recording settings are stored in the <code>Channel</code> element. The first part defines for which component the settings are meant, the second part describes the settings.</p>
<ul>
<li><code>box=&quot;-&quot;</code> means for all boxes that are connected.</li>
<li><code>probe=&quot;-&quot;</code> means for all probes that are connected.</li>
<li><code>channel=&quot;-&quot;</code> means for all recording channels (always 64).</li>
<li><code>references=&quot;-&quot;</code> means all <a href="#references-and-input-settings">reference</a>, this means the Body reference and references 1-8.</li>
<li><code>gain=&quot;1&quot;</code> means the channel <a href="#gain-settings">gain</a>. The possible values are:
<ul>
<li>&quot;0&quot;: x 60</li>
<li>&quot;1&quot;: x 24</li>
<li>&quot;2&quot;: x 12</li>
<li>&quot;3&quot;: x 0.16</li>
</ul>
</li>
<li><code>input=&quot;0&quot;</code> means which <a href="#choosing-probe-electrodes">input</a> electrode should be connected to the recording channel.</li>
</ul>
<p>You can also specify the settings more precisely. For example, if you want recording channels 1, 6, 7 and 8 to have fewer references, namely only reference 'b' (body) and '3':</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Program</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Settings</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RecordingSettings</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Channel</span> <span class="hljs-attr">box</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">probe</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">channel</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">references</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">gain</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">input</span>=<span class="hljs-string">"0"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Channel</span> <span class="hljs-attr">box</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">probe</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">channel</span>=<span class="hljs-string">"1,6-8"</span> <span class="hljs-attr">references</span>=<span class="hljs-string">"b,3"</span> <span class="hljs-attr">gain</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">input</span>=<span class="hljs-string">"0"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecordingSettings</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Settings</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Program</span>&gt;</span>
</div></code></pre>
<p>In the above case, the first line will be loaded to the ViperBox first and then the latter channel settings will be overwritten to the specific channels.</p>
<h2 id="stimulation-settings">Stimulation settings</h2>
<p>The default stimulation settings are the following:</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Program</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Settings</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">StimulationWaveformSettings</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">box</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">probe</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">stimunit</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">polarity</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">pulses</span>=<span class="hljs-string">"20"</span> <span class="hljs-attr">prephase</span>=<span class="hljs-string">"0"</span>
                <span class="hljs-attr">amplitude1</span>=<span class="hljs-string">"5"</span> <span class="hljs-attr">width1</span>=<span class="hljs-string">"170"</span> <span class="hljs-attr">interphase</span>=<span class="hljs-string">"60"</span> <span class="hljs-attr">amplitude2</span>=<span class="hljs-string">"5"</span> <span class="hljs-attr">width2</span>=<span class="hljs-string">"170"</span>
                <span class="hljs-attr">discharge</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">duration</span>=<span class="hljs-string">"600"</span> <span class="hljs-attr">aftertrain</span>=<span class="hljs-string">"1000"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">StimulationWaveformSettings</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">StimulationMappingSettings</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Mapping</span> <span class="hljs-attr">box</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">probe</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">stimunit</span>=<span class="hljs-string">"-"</span> <span class="hljs-attr">electrodes</span>=<span class="hljs-string">"-"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">StimulationMappingSettings</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Settings</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Program</span>&gt;</span>
</div></code></pre>
<p>In StimulationWaveformSettings, <code>stimunit</code> means stimulation unit which is a waveform generator, there are 8 stimulation units per probe.
In StimulationMappingSettings, these stimulation units can be connected to any or all of the electrodes.</p>
<figure>
    <img src="imgs\stimulation_timing.png" style="width: 90%; height: auto;">
    <figcaption align="center">Stimulation timing</figcaption>
</figure>
<p>The possible parameters for the stimulation units are:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Description</th>
<th>Unit</th>
<th>Range</th>
<th>Step size</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>polarity</code></td>
<td>Polarity of the stimulation waveform</td>
<td>boolean</td>
<td>0-1</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td><code>pulses</code></td>
<td>Number of pulses in the waveform</td>
<td>number</td>
<td>1-255</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td><code>prephase</code></td>
<td>Time in microseconds before the first pulse</td>
<td>μs</td>
<td>100-25500</td>
<td>100</td>
<td>0</td>
</tr>
<tr>
<td><code>amplitude1</code></td>
<td>Amplitude of the first phase</td>
<td>μA</td>
<td>0-255</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td><code>width1</code></td>
<td>Width of the first phase</td>
<td>μs</td>
<td>10-2550</td>
<td>10</td>
<td>170</td>
</tr>
<tr>
<td><code>interphase</code></td>
<td>Time between the first and second phase</td>
<td>μs</td>
<td>10-25500</td>
<td>10</td>
<td>60</td>
</tr>
<tr>
<td><code>amplitude2</code></td>
<td>Amplitude of the second phase</td>
<td>μA</td>
<td>0-255</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td><code>width2</code></td>
<td>Width of the second phase</td>
<td>μs</td>
<td>10-2550</td>
<td>10</td>
<td>170</td>
</tr>
<tr>
<td><code>discharge</code></td>
<td>Time in microseconds after the last pulse</td>
<td>μs</td>
<td>100-25500</td>
<td>100</td>
<td>200</td>
</tr>
<tr>
<td><code>duration</code></td>
<td>Duration of the entire train</td>
<td>μs</td>
<td>100-25500</td>
<td>100</td>
<td>600</td>
</tr>
<tr>
<td><code>aftertrain</code></td>
<td>Time in microseconds after the entire train has finished</td>
<td>μs</td>
<td>100-25500</td>
<td>100</td>
<td>1000</td>
</tr>
</tbody>
</table>
<!-- ## XML control scripts
XML scripts can have full or partial control over the ViperBox. They can be used for:
- defining settings
- starting and stopping recording and stimulation

The format is as follows:
```xml
<Program>
    <Settings>
        <RecordingSettings>
            <Channel box="-" probe="-" channel="-" references="100000000" gain="1" input="0" />
        </RecordingSettings>
        <StimulationWaveformSettings>
            <Configuration box="-" probe="-" stimunit="-" polarity="0" pulses="20"
                prephase="0" amplitude1="1" width1="170" interphase="60" amplitude2="1" width2="170"
                discharge="200" duration="600" aftertrain="1000" />
        </StimulationWaveformSettings>
        <StimulationMappingSettings>
            <Mapping box="-" probe="-" stimunit="-" electrodes="-" />
        </StimulationMappingSettings>
    </Settings>
</Program>
```

As can be seen from the sample, at the highest level there is the program element. Below that there are settings or instructions. In settings there are RecordingSettings, StimulationWaveformSettings and StimulationMapping settings. -->
<h1 id="%F0%9F%91%A8%E2%80%8D%F0%9F%92%BB-related-software">👨‍💻 Related software</h1>
<h2 id="open-ephys">Open Ephys</h2>
<p>ViperBoxInterface uses Open Ephys to show the recorded data. Please refer to the documentation
of Open Ephys for instructions on how to use it. It has various possibilities to visualize and
analyze the data. The documentation can be found <a href="https://open-ephys.github.io/gui-docs/User-Manual/Exploring-the-user-interface.html">here</a>.</p>
<!-- ## Anaconda
Anaconda is used to set up and run the Python environment that is needed for the 
ViperBoxInterface to run.

## Git
Git is used to download the latest version of the software. -->

</body>
</html>
